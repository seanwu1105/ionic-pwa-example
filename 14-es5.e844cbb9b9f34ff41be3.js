!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var c,a=e[Symbol.iterator]();!(r=(c=a.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=o(e);if(t){var c=o(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return i(this,n)}}function i(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{QDOj:function(t,i,o){"use strict";o.r(i),o.d(i,"CameraPageModule",function(){return re});var a,s=o("PCNd"),f=o("tyNb"),l=o("mrSG"),b=o("VfN6"),p=o("2Vo4"),d=o("r0o6"),v=o("/uUt"),h=o("bOdf"),m=o("JIr8"),g=o("KJy6"),O=o("fXoL"),j=o("O/LV"),y=o("BJdS"),x=o("LRne"),$=o("z6cu"),w=o("NXyV"),k=o("jtHE"),C=o("lJxs"),P=o("UXun"),S=o("vkgz"),_=o("CqXF"),E=o("SxV6"),I=o("eIep"),M=o("q7zd"),R=o("JX91"),U=o("7o/Q"),V=function(){function e(){c(this,e)}return u(e,[{key:"call",value:function(e,t){return t.subscribe(new D(e))}}]),e}(),D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(i,e);var t=r(i);function i(e){var n;return c(this,i),(n=t.call(this,e)).hasPrev=!1,n}return u(i,[{key:"_next",value:function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}]),i}(U.a),z=((a=function(){function t(){c(this,t),this.videoStreamSelector=new L,this.videoDevices$=this.videoStreamSelector.devices$,this.mediaStream$=this.videoStreamSelector.stream$,this.imageCapture$=this.mediaStream$.pipe(Object(C.a)(function(e){return e.getVideoTracks()[0]}),Object(g.c)(),Object(C.a)(function(e){return new ImageCapture(e)}),Object(P.a)({bufferSize:1,refCount:!0})),this._capturedImageUrl$=new p.a(void 0),this.capturedImageUrl$=this._capturedImageUrl$.pipe(Object(g.c)(),Object(v.a)(),function(t){return t.pipe(Object(R.a)(void 0),function(e){return e.lift(new V)},Object(S.a)(function(t){var n=e(t,1)[0];n&&URL.revokeObjectURL(n)}),Object(M.a)(t))})}return u(t,[{key:"connectPreview$",value:function(e){return this.mediaStream$.pipe(Object(S.a)(function(t){return e.srcObject=t}),Object(_.a)(e))}},{key:"capture$",value:function(){var e=this;return this.imageCapture$.pipe(Object(E.a)(),Object(I.a)(function(e){return e.takePhoto()}),Object(S.a)(function(t){e._capturedImageUrl$.next(URL.createObjectURL(t))}),Object(m.a)(function(e){return e instanceof DOMException&&("InvalidStateError"===e.name||"UnknownError"===e.name||"OperationError"===e.name)?Object(x.a)(void 0):Object($.a)(e)}),Object(g.c)())}},{key:"nextCamera$",value:function(e){var t=this;return this.videoDevices$.pipe(Object(E.a)(),Object(h.a)(function(n){return Object(d.a)(function(){return n.length>1},Object(w.a)(function(){return Object(l.a)(t,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.srcObject=null);case 1:case"end":return t.stop()}},t)}))}).pipe(Object(M.a)(t.videoStreamSelector.next$())))}))}}]),t}()).\u0275fac=function(e){return new(e||a)},a.\u0275prov=O.Mb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),L=function(){function e(){var t=this;c(this,e),this.devices$=Object(w.a)(function(){return navigator.mediaDevices.enumerateDevices()}).pipe(Object(C.a)(function(e){return e.filter(function(e){return"videoinput"===e.kind})}),Object(P.a)({bufferSize:1,refCount:!0})),this.currentVideoDeviceIndex=0,this._stream$=new k.a(1),this.stream$=this.devices$.pipe(Object(E.a)(),Object(h.a)(function(e){return t.getCurrentVideoMedia(e)}),Object(S.a)(function(e){return t._stream$.next(e)}),Object(M.a)(this._stream$),Object(P.a)({bufferSize:1,refCount:!0}),Object(g.c)(),Object(g.b)(function(e){return function(e){return e.getVideoTracks().forEach(function(e){return e.stop()}),e}(e)}),Object(P.a)({bufferSize:1,refCount:!0}))}return u(e,[{key:"next$",value:function(){var e=this;return this.stream$.pipe(Object(E.a)(),Object(S.a)(function(e){return e.getVideoTracks().forEach(function(e){return e.stop()})}),Object(M.a)(this.devices$),Object(S.a)(function(){return e.currentVideoDeviceIndex++}),Object(h.a)(function(t){return e.getCurrentVideoMedia(t)}),Object(S.a)(function(t){return e._stream$.next(t)}))}},{key:"getCurrentVideoMedia",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",navigator.mediaDevices.getUserMedia({video:{deviceId:e[this.currentVideoDeviceIndex%e.length].deviceId}}));case 1:case"end":return t.stop()}},t,this)}))}}]),e}(),A=o("zXXW"),T=o("ofXK"),F=o("TEn/"),X=o("9A8T"),J=o("/T4s"),N=o("QPBi"),Q=["video"];function K(e,t){if(1&e){var n=O.Wb();O.Vb(0,"ion-button",9),O.dc("click",function(){return O.qc(n),O.fc(2).reverseCamera()}),O.Rb(1,"ion-icon",10),O.Ub()}}var q=function(e){return["/image-viewer",e]};function B(e,t){if(1&e&&(O.Vb(0,"div",11),O.Rb(1,"app-image",12),O.Ub()),2&e){var n=t.ngrxLet;O.Fb(1),O.lc("routerLink",O.nc(2,q,n))("src",n)}}function W(e,t){if(1&e){var n=O.Wb();O.Tb(0),O.Vb(1,"ion-button",3),O.dc("click",function(){return O.qc(n),O.fc().capture()}),O.Rb(2,"ion-icon",4),O.Ub(),O.xc(3,K,2,0,"ion-button",5),O.gc(4,"ngrxPush"),O.xc(5,B,2,4,"div",6),O.Rb(6,"video",7,8),O.Sb()}if(2&e){var r,i=O.fc();O.Fb(3),O.lc("ngIf",(null==(r=O.hc(4,2,i.videoDevices$))?null:r.length)>1),O.Fb(2),O.lc("ngrxLet",i.capturedImageUrl$)}}function H(e,t){if(1&e&&(O.Vb(0,"div",15),O.Rb(1,"ion-img",16),O.Vb(2,"h3"),O.zc(3),O.Ub(),O.Vb(4,"p"),O.zc(5),O.Ub(),O.Ub()),2&e){var n=t.$implicit;O.Fb(3),O.Ac(n("noCameraFound")),O.Fb(2),O.Ac(n("message.noCameraFound"))}}function G(e,t){1&e&&(O.Vb(0,"div",13),O.xc(1,H,6,2,"div",14),O.Ub())}var Y,Z,ee,te=[{path:"",component:(Y=function(){function e(t,n,r){c(this,e),this.dialogsService=t,this.momentRepository=n,this.cameraService=r,this.videoDevices$=this.cameraService.videoDevices$,this._videoElement$=new p.a(void 0),this.videoElement$=this._videoElement$.pipe(Object(g.c)(),Object(v.a)()),this.capturedImageUrl$=this.cameraService.capturedImageUrl$,this.startPreview()}return u(e,[{key:"videoElement",set:function(e){e&&this._videoElement$.next(e.nativeElement)}},{key:"startPreview",value:function(){var e=this;return this.videoElement$.pipe(Object(h.a)(function(t){return e.cameraService.connectPreview$(t)}),Object(m.a)(function(t){return e.presentError$(t)}),Object(b.b)(this)).subscribe()}},{key:"capture",value:function(){var e=this;this.cameraService.capture$().pipe(Object(g.a)(function(t){return e.momentRepository.add$(t)}),Object(m.a)(function(t){return e.presentError$(t)}),Object(b.b)(this)).subscribe()}},{key:"reverseCamera",value:function(){var e=this;return this.videoElement$.pipe(Object(h.a)(function(t){return e.cameraService.nextCamera$(t)}),Object(m.a)(function(t){return e.presentError$(t)}),Object(b.b)(this)).subscribe()}},{key:"presentError$",value:function(e){return Object(d.a)(function(){return e instanceof DOMException&&"NotAllowedError"===e.name},this.dialogsService.presentAlert$({headerKey:"error.".concat(e.name),messageKey:"message.cameraPermissionDenied"}),this.dialogsService.presentError$(e))}}]),e}(),Y.\u0275fac=function(e){return new(e||Y)(O.Qb(j.a),O.Qb(y.a),O.Qb(z))},Y.\u0275cmp=O.Kb({type:Y,selectors:[["app-camera"]],viewQuery:function(e,t){var n;1&e&&O.Ec(Q,1),2&e&&O.oc(n=O.ec())&&(t.videoElement=n.first)},decls:5,vars:5,consts:[["color","light","fill","clear",1,"dismiss",3,"standalone"],[4,"ngIf","ngIfElse"],["noCamera",""],["fill","clear",1,"capture",3,"click"],["slot","icon-only","name","radio-button-on-outline","color","light"],["class","capture","class","reverse-camera","fill","clear",3,"click",4,"ngIf"],["class","captured ion-margin",4,"ngrxLet"],["playsinline","","autoplay",""],["video",""],["fill","clear",1,"reverse-camera",3,"click"],["slot","icon-only","name","camera-reverse-outline","color","light"],[1,"captured","ion-margin"],[3,"routerLink","src"],[1,"no-camera"],["class","no-camera-illustration",4,"transloco"],[1,"no-camera-illustration"],["src","./assets/icons/undraw-void.svg"]],template:function(e,t){if(1&e&&(O.Rb(0,"app-back-button",0),O.xc(1,W,8,4,"ng-container",1),O.gc(2,"ngrxPush"),O.xc(3,G,2,0,"ng-template",null,2,O.yc)),2&e){var n,r=O.pc(4);O.lc("standalone",!0),O.Fb(1),O.lc("ngIf",0!==(null==(n=O.hc(2,3,t.videoDevices$))?null:n.length))("ngIfElse",r)}},directives:[A.a,T.l,F.d,F.n,X.a,J.a,F.H,f.i,N.c,F.o],pipes:[X.b],styles:["[_nghost-%COMP%]{background:var(--ion-color-dark)}video[_ngcontent-%COMP%]{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center}.dismiss[_ngcontent-%COMP%]{position:absolute;left:0;z-index:1}ion-button.capture[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%);z-index:1;height:72px;width:72px;margin:0 0 var(--ion-margin,16px);--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4)}ion-button.capture[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px}ion-button.reverse-camera[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:16px;z-index:1;height:48px;width:48px;--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4)}.captured[_ngcontent-%COMP%]{position:absolute;bottom:16px;right:16px;overflow:hidden;border-radius:4px;border:1px solid var(--ion-color-light-shade)}.captured[_ngcontent-%COMP%]   app-image[_ngcontent-%COMP%]{z-index:1;width:60px;height:60px}.no-camera[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--ion-color-light-shade)}.no-camera-illustration[_ngcontent-%COMP%]{width:70%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}.no-camera-illustration[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{margin:auto;max-width:400px}.no-camera-illustration[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{white-space:pre-line}"]}),Y=Object(l.b)([Object(b.a)()],Y))}],ne=((ee=function e(){c(this,e)}).\u0275fac=function(e){return new(e||ee)},ee.\u0275mod=O.Ob({type:ee}),ee.\u0275inj=O.Nb({imports:[[f.j.forChild(te)],f.j]}),ee),re=((Z=function e(){c(this,e)}).\u0275fac=function(e){return new(e||Z)},Z.\u0275mod=O.Ob({type:Z}),Z.\u0275inj=O.Nb({imports:[[s.a,ne]]}),Z)}}])}();