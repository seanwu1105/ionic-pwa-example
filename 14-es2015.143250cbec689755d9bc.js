(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{QDOj:function(e,t,i){"use strict";i.r(t),i.d(t,"CameraPageModule",function(){return B});var n=i("PCNd"),r=i("tyNb"),c=i("mrSG"),a=i("VfN6"),o=i("jtHE"),s=i("r0o6"),d=i("bOdf"),b=i("JIr8"),l=i("KJy6"),u=i("fXoL"),p=i("O/LV"),h=i("BJdS"),m=i("LRne"),v=i("z6cu"),g=i("NXyV"),O=i("lJxs"),f=i("UXun"),j=i("/uUt"),$=i("vkgz"),x=i("CqXF"),C=i("SxV6"),w=i("eIep"),P=i("q7zd"),S=i("JX91"),k=i("7o/Q");class E{call(e,t){return t.subscribe(new M(e))}}class M extends k.a{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}let _=(()=>{class e{constructor(){this.videoStreamSelector=new I,this.videoDevices$=this.videoStreamSelector.devices$,this.mediaStream$=this.videoStreamSelector.stream$,this.imageCapture$=this.mediaStream$.pipe(Object(O.a)(e=>e.getVideoTracks()[0]),Object(l.d)(),Object(O.a)(e=>new ImageCapture(e)),Object(f.a)({bufferSize:1,refCount:!0})),this._capturedImageUrl$=new o.a(1),this.capturedImageUrl$=this._capturedImageUrl$.pipe(Object(j.a)(),e=>e.pipe(Object(S.a)(void 0),e=>e.lift(new E),Object($.a)(([e])=>{e&&URL.revokeObjectURL(e)}),Object(P.a)(e)))}connectPreview$(e){return this.mediaStream$.pipe(Object($.a)(t=>e.srcObject=t),Object(x.a)(e))}capture$(){return this.imageCapture$.pipe(Object(C.a)(),Object(w.a)(e=>e.takePhoto()),Object($.a)(e=>{this._capturedImageUrl$.next(URL.createObjectURL(e))}),Object(b.a)(e=>e instanceof DOMException&&("InvalidStateError"===e.name||"UnknownError"===e.name||"OperationError"===e.name)?Object(m.a)(void 0):Object(v.a)(e)),Object(l.d)())}nextCamera$(e){return this.videoDevices$.pipe(Object(C.a)(),Object(d.a)(t=>Object(s.a)(()=>t.length>1,Object(g.a)(()=>Object(c.a)(this,void 0,void 0,function*(){return e.srcObject=null})).pipe(Object(P.a)(this.videoStreamSelector.next$())))))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=u.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class I{constructor(){this.devices$=Object(g.a)(()=>navigator.mediaDevices.enumerateDevices()).pipe(Object(O.a)(e=>e.filter(e=>"videoinput"===e.kind)),Object(f.a)({bufferSize:1,refCount:!0})),this.currentVideoDeviceIndex=0,this._stream$=new o.a(1),this.stream$=this.devices$.pipe(Object(C.a)(),Object(d.a)(e=>this.getCurrentVideoMedia(e)),Object($.a)(e=>this._stream$.next(e)),Object(P.a)(this._stream$),Object(f.a)({bufferSize:1,refCount:!0}),Object(l.d)(),Object(l.c)(e=>function(e){return e.getVideoTracks().forEach(e=>e.stop()),e}(e)),Object(f.a)({bufferSize:1,refCount:!0}))}next$(){return this.stream$.pipe(Object(C.a)(),Object($.a)(e=>e.getVideoTracks().forEach(e=>e.stop())),Object(P.a)(this.devices$),Object($.a)(()=>this.currentVideoDeviceIndex++),Object(d.a)(e=>this.getCurrentVideoMedia(e)),Object($.a)(e=>this._stream$.next(e)))}getCurrentVideoMedia(e){return Object(c.a)(this,void 0,void 0,function*(){return navigator.mediaDevices.getUserMedia({video:{deviceId:e[this.currentVideoDeviceIndex%e.length].deviceId}})})}}var y=i("zXXW"),U=i("ofXK"),V=i("TEn/"),D=i("9A8T"),z=i("/T4s"),R=i("QPBi");const L=["video"];function F(e,t){if(1&e){const e=u.Wb();u.Vb(0,"ion-button",9),u.dc("click",function(){return u.rc(e),u.fc(2).reverseCamera()}),u.Rb(1,"ion-icon",10),u.Ub()}}const X=function(e){return["/image-viewer",e]};function J(e,t){if(1&e&&(u.Vb(0,"div",11),u.Rb(1,"app-image",12),u.Ub()),2&e){const e=t.ngrxLet;u.Fb(1),u.lc("routerLink",u.nc(2,X,e))("src",e)}}function N(e,t){if(1&e){const e=u.Wb();u.Tb(0),u.Vb(1,"ion-button",3),u.dc("click",function(){return u.rc(e),u.fc().capture()}),u.Rb(2,"ion-icon",4),u.Ub(),u.yc(3,F,2,0,"ion-button",5),u.gc(4,"ngrxPush"),u.yc(5,J,2,4,"div",6),u.Rb(6,"video",7,8),u.Sb()}if(2&e){const e=u.fc();let t=null;u.Fb(3),u.lc("ngIf",(null==(t=u.hc(4,2,e.videoDevices$))?null:t.length)>1),u.Fb(2),u.lc("ngrxLet",e.capturedImageUrl$)}}function Q(e,t){if(1&e&&(u.Vb(0,"div",15),u.Rb(1,"ion-img",16),u.Vb(2,"h3"),u.Ac(3),u.Ub(),u.Vb(4,"p"),u.Ac(5),u.Ub(),u.Ub()),2&e){const e=t.$implicit;u.Fb(3),u.Bc(e("noCameraFound")),u.Fb(2),u.Bc(e("message.noCameraFound"))}}function T(e,t){1&e&&(u.Vb(0,"div",13),u.yc(1,Q,6,2,"div",14),u.Ub())}const A=[{path:"",component:(()=>{let e=class{constructor(e,t,i){this.dialogsService=e,this.momentRepository=t,this.cameraService=i,this.videoDevices$=this.cameraService.videoDevices$,this.videoElement$=new o.a(1),this.capturedImageUrl$=this.cameraService.capturedImageUrl$,this.startPreview()}set videoElement(e){e&&this.videoElement$.next(e.nativeElement)}startPreview(){return this.videoElement$.pipe(Object(d.a)(e=>this.cameraService.connectPreview$(e)),Object(b.a)(e=>this.presentError$(e)),Object(a.b)(this)).subscribe()}capture(){return this.cameraService.capture$().pipe(Object(l.b)(e=>this.momentRepository.add$(e)),Object(b.a)(e=>this.presentError$(e)),Object(a.b)(this)).subscribe()}reverseCamera(){return this.videoElement$.pipe(Object(d.a)(e=>this.cameraService.nextCamera$(e)),Object(b.a)(e=>this.presentError$(e)),Object(a.b)(this)).subscribe()}presentError$(e){return Object(s.a)(()=>e instanceof DOMException&&"NotAllowedError"===e.name,this.dialogsService.presentAlert$({headerKey:`error.${e.name}`,messageKey:"message.cameraPermissionDenied"}),this.dialogsService.presentError$(e))}};return e.\u0275fac=function(t){return new(t||e)(u.Qb(p.a),u.Qb(h.a),u.Qb(_))},e.\u0275cmp=u.Kb({type:e,selectors:[["app-camera"]],viewQuery:function(e,t){if(1&e&&u.Fc(L,1),2&e){let e;u.pc(e=u.ec())&&(t.videoElement=e.first)}},decls:5,vars:5,consts:[["color","light","fill","clear",1,"dismiss",3,"standalone"],[4,"ngIf","ngIfElse"],["noCamera",""],["fill","clear",1,"capture",3,"click"],["slot","icon-only","name","radio-button-on-outline","color","light"],["class","capture","class","reverse-camera","fill","clear",3,"click",4,"ngIf"],["class","captured ion-margin",4,"ngrxLet"],["playsinline","","autoplay","","muted",""],["video",""],["fill","clear",1,"reverse-camera",3,"click"],["slot","icon-only","name","camera-reverse-outline","color","light"],[1,"captured","ion-margin"],[3,"routerLink","src"],[1,"no-camera"],["class","no-camera-illustration",4,"transloco"],[1,"no-camera-illustration"],["src","./assets/icons/undraw-void.svg"]],template:function(e,t){if(1&e&&(u.Rb(0,"app-back-button",0),u.yc(1,N,8,4,"ng-container",1),u.gc(2,"ngrxPush"),u.yc(3,T,2,0,"ng-template",null,2,u.zc)),2&e){const e=u.qc(4);let i=null;u.lc("standalone",!0),u.Fb(1),u.lc("ngIf",0!==(null==(i=u.hc(2,3,t.videoDevices$))?null:i.length))("ngIfElse",e)}},directives:[y.a,U.l,V.d,V.n,D.a,z.a,V.H,r.i,R.c,V.o],pipes:[D.b],styles:["[_nghost-%COMP%]{background:var(--ion-color-dark)}video[_ngcontent-%COMP%]{height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center;width:100%}.dismiss[_ngcontent-%COMP%]{left:0;position:absolute;z-index:1}ion-button.capture[_ngcontent-%COMP%]{--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4);bottom:0;height:72px;left:50%;margin:0 0 var(--ion-margin,16px);position:absolute;transform:translate(-50%);width:72px;z-index:1}ion-button.capture[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px}ion-button.reverse-camera[_ngcontent-%COMP%]{--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4);bottom:16px;height:48px;left:16px;position:absolute;width:48px;z-index:1}.captured[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light-shade);border-radius:4px;bottom:16px;overflow:hidden;position:absolute;right:16px}.captured[_ngcontent-%COMP%]   app-image[_ngcontent-%COMP%]{height:60px;width:60px;z-index:1}.no-camera[_ngcontent-%COMP%]{background:var(--ion-color-light-shade);height:100%;width:100%}.no-camera-illustration[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-50%);width:70%}.no-camera-illustration[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{margin:auto;max-width:400px}.no-camera-illustration[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{white-space:pre-line}"]}),e=Object(c.b)([Object(a.a)()],e),e})()}];let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.Ob({type:e}),e.\u0275inj=u.Nb({imports:[[r.j.forChild(A)],r.j]}),e})(),B=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.Ob({type:e}),e.\u0275inj=u.Nb({imports:[[n.a,K]]}),e})()}}]);